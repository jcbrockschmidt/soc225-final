---
title: "R Notebook"
output: html_notebook
---

# Setup environment
```{r}
#install.packages("tidyverse")
#install.packages("gridExtra")
library(tidyverse)
library(gridExtra)
alcData <- read_csv("data/HappinessAlcoholRegulations-2016.csv")
```

```{r}
alcData <- alcData %>%
  mutate(OnPremisePurchaseAge = parse_number(OnPremisePurchaseAge))

# Remove NA values
rowsBefore <- nrow(alcData)
alcData <- alcData[!is.na(alcData$OnPremisePurchaseAge), ]
rowsAfter <- nrow(alcData)
sprintf("%d/%d rows removed", rowsBefore - rowsAfter, rowsBefore, rowsAfter)

alcData
```

# Plots

```{r}
ageVsFreedom <- alcData %>%
  ggplot(aes(x = `OnPremisePurchaseAge`, 
             y = `Freedom`)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm")

ageVsHapp <- alcData %>%
  ggplot(aes(x = `OnPremisePurchaseAge`, 
             y = `HappinessScore`)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm")

grid.arrange(ageVsFreedom, ageVsHapp, ncol=2)
```

```{r}
beerVsHapp <- alcData %>%
  ggplot(aes(x = `Beer_PerCapita`, 
             y = `HappinessScore`)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm")

wineVsHapp <- alcData %>%
  ggplot(aes(x = `Wine_PerCapita`, 
             y = `HappinessScore`)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm")

spiritVsHapp <- alcData %>%
  ggplot(aes(x = `Spirit_PerCapita`, 
             y = `HappinessScore`)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm")

grid.arrange(beerVsHapp, wineVsHapp, spiritVsHapp, ncol=2)
```

```{r}
beerVsFree <- alcData %>%
  ggplot(aes(x = `Beer_PerCapita`, 
             y = `Freedom`)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm") +
  xlab("Beer Per Capita") +
  ylab("Freedom Score")

wineVsFree <- alcData %>%
  ggplot(aes(x = `Wine_PerCapita`, 
             y = `Freedom`)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm") +
  xlab("Wine Per Capita") +
  ylab("Freedom Score") 

spiritVsFree <- alcData %>%
  ggplot(aes(x = `Spirit_PerCapita`, 
             y = `Freedom`)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm") +
  xlab("Spirit Per Capita") +
  ylab("Freedom Score") 

grid.arrange(beerVsFree, wineVsFree, spiritVsFree, ncol=2, top="How Alcohol Consumption Relates to Feelings of Freedom")
```

```{r}
alcData %>%
  ggplot(aes(x = `HappinessScore`, 
             y = `Freedom`)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm") +
  xlab("Happiness Score") +
  ylab("Freedom Score") +
  labs(title = "How Feelings of Freedom Relate to Happiness Score of a Country")
```

```{r}
alcData <- alcData %>% mutate(totalAlc = (Spirit_PerCapita + Wine_PerCapita + Beer_PerCapita))

alcData %>%
  ggplot(aes(x = `HappinessScore`, 
             y = `totalAlc`)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm") +
facet_wrap(~Region) +
  xlab("Happiness Score") +
  ylab("Alcohol Consumption Per Capita") +
  labs(title = "How Alcohol Consumption Relates to Happiness Score by Region", 
       subtitle = "Happiness Score was created based on a scaled happiness survey") 
```

```{r}
alcData <- alcData %>% mutate(total = (Spirit_PerCapita + Wine_PerCapita + Beer_PerCapita))

alcData %>%
  ggplot(aes(x = `OnPremisePurchaseAge`, 
             y = `total`)) +
  geom_col(fill = "blue3") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
facet_wrap(~Region) +
  xlab("Legal Drinking Age") +
  ylab("Alcohol Consumption Per Capita") +
  labs(title = "How Alcohol Consumption Relates to Legal Drinking Age by Region")
```

```{r}
alcData <- alcData %>% arrange(alcData$HappinessRank)
top <- alcData %>% head(5)
bottom <- alcData %>% tail(5)
alc<- full_join(top,bottom)
alc <- alc %>% mutate(total = (Spirit_PerCapita + Wine_PerCapita + Beer_PerCapita))
alc %>%
  ggplot(aes(x = factor(Country,c('Denmark', 'Switzerland', 'Iceland', 'Norway', 'Finland', 'Chad', 'Madagascar', 'Tanzania', 'Liberia', 'Syria')), 
             y = `total`, fill = GDP_PerCapita)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  xlab("Top 5 and Bottom 5 Happiness Scoring Countries (Left to Right)") +
  ylab("Alcohol Consumption Per Capita") +
  labs(title = "How Alcohol Consumption and GDP Relates to Happiness Scores by Country", fill='GDP Per Capita')
```

```{r}
alcData <- alcData %>% arrange(alcData$HappinessRank)
top <- alcData %>% head(5)
bottom <- alcData %>% tail(5)
alc<- full_join(top,bottom)
alc <- alc %>% mutate(total = (Spirit_PerCapita + Wine_PerCapita + Beer_PerCapita))
plot <- alc %>%
  ggplot(aes(x = factor(Country,c('Denmark', 'Switzerland', 'Iceland', 'Norway', 'Finland', 'Chad', 'Madagascar', 'Tanzania', 'Liberia', 'Syria')), 
             y = `total`, fill = factor(OnPremisePurchaseAge))) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  xlab("Top 5 and Bottom 5 Happiness Scoring Countries (Left to Right)") +
  ylab("Alcohol Consumption Per Capita") +
  labs(title = "How Alcohol Consumption Relates and \nLegal Drinking Age to Happiness Scores by Country", fill='Legal Drinking Age')
plot + scale_fill_brewer(palette="Blues")
```
